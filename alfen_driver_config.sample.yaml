# Sample configuration for Alfen Driver
# Copy to alfen_driver_config.yaml and edit as needed

modbus:
  ip: 10.128.0.64 # IP address of the Alfen charger
  port: 502 # Modbus TCP port (default 502)
  socket_slave_id: 1 # Slave ID for socket-related registers
  station_slave_id: 200 # Slave ID for station-related registers

device_instance: 0 # Unique instance ID for D-Bus service (change if multiple chargers)

registers:
  voltages: 306 # Starting register for phase voltages (3 floats, 6 words)
  currents: 320 # Starting register for phase currents (3 floats, 6 words)
  power: 344 # Starting register for total power (1 float, 2 words)
  energy: 374 # Starting register for total energy (1 double, 4 words)
  status: 1201 # Starting register for status string (5 words)
  amps_config: 1210 # Register for setting configured current (1 float, 2 words)
  phases: 1215 # Register for number of active phases (1 uint16)
  firmware_version: 123 # Starting register for firmware version string
  firmware_version_count: 17 # Number of registers for firmware string
  station_serial: 157 # Starting register for station serial number string
  station_serial_count: 11 # Number of registers for serial string
  manufacturer: 117 # Starting register for manufacturer string
  manufacturer_count: 5 # Number of registers for manufacturer
  platform_type: 140 # Starting register for platform type string
  platform_type_count: 17 # Number of registers for platform type
  station_max_current: 1100 # Register for station max current (1 float, 2 words)

defaults:
  intended_set_current: 6.0 # Default charging current in amps
  station_max_current: 16.0 # Default max current if read fails
  timezone: "Europe/Amsterdam"

logging:
  level: INFO # Logging level (DEBUG, INFO, WARNING, ERROR)
  file: /var/log/alfen_driver.log # Path to log file

schedules:
  # Default schedule: 12:00-15:00 every day (days_mask=127 sums 1+2+4+8+16+32+64 for Sun-Sat). This is normally the cheapest hours with dynamic tariffs.
  - enabled: 1 # 1 to enable this schedule, 0 to disable
    days_mask: 127 # Bitmask for days (Sun=1, Mon=2, ..., Sat=64; sum for multiple)
    start: 12:00 # Start time in HH:MM (24h format)
    end: 15:00 # End time in HH:MM
# You can add up to 2 more schedules like the above

controls:
  current_tolerance: 0.25 # Tolerance for verifying set current (in amps)
  update_difference_threshold: 0.1 # Min difference to trigger current update
  verification_delay: 0.1 # Delay (seconds) before verifying write
  retry_delay: 0.5 # Delay between retries (seconds)
  max_retries: 3 # Max retry attempts for Modbus operations
  watchdog_interval_seconds: 30 # Interval to refresh current (watchdog)
  max_set_current: 64.0 # Absolute max settable current (safety limit)

poll_interval_ms: 1000 # Base polling interval in milliseconds (adaptive in code)
